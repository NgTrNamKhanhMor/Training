<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <style>
        .calculator-container {
            max-width: 400px;
            margin: 0 auto;
        }
        .display {
            font-size: 1.5em;
        }
        .button {
            height: 60px;
            font-size: 1.2em;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
        }
        .operator {
            background-color: #f0f0f0;
        }
        .operator:hover {
            background-color: #e0e0e0;
        }
        .equal {
            background-color: #1976d2;
            color: white;
        }
        .equal:hover {
            background-color: #1565c0;
        }
        #display{
            width: 100%;
            height: 50px;
        }
    </style>
</head>
<body>
    <div class="container px-4 px-lg-5 text-bg-dark h-100 my-4 calculator-container">
        <div class="row ">
            <div class="col-12 text-bg-light text-center p-0">
                <div class="w-100 display text-center p-2 border-0" id="display"></div>
            </div>
        </div>
        <div class="row ">
            <div class="col-3 button text-bg-light border" data-value="C">C</div>
            <div class="col-3 button text-bg-light operator border" data-value="sqrt">&radic;</div>
            <div class="col-3 button text-bg-light operator border" data-value="square">x<sup>2</sup></div>
            <div class="col-3 button text-bg-light operator border" data-value="+">+</div>


        </div>
        <div class="row ">
            <div class="col-3 button text-bg-light operator border" data-value="7">7</div>
            <div class="col-3 button text-bg-light operator border" data-value="8">8</div>
            <div class="col-3 button text-bg-light operator border" data-value="9">9</div>
            <div class="col-3 button text-bg-light operator border" data-value="-">-</div>
        </div>
        <div class="row ">
            <div class="col-3 button text-bg-light operator border" data-value="4">4</div>
            <div class="col-3 button text-bg-light operator border" data-value="5">5</div>
            <div class="col-3 button text-bg-light operator border" data-value="6">6</div>
            <div class="col-3 button text-bg-light operator border" data-value="*">x</div>

        </div>
        <div class="row ">
            <div class="col-3 button text-bg-light operator border" data-value="1">1</div>
            <div class="col-3 button text-bg-light operator border" data-value="2">2</div>
            <div class="col-3 button text-bg-light operator border" data-value="3">3</div>
            <div class="col-3 button text-bg-light operator border" data-value="/">/</div>
        </div>
        <div class="row ">
            <div class="col-3 button text-bg-light operator border" data-value="bracket">()</div>

            <div class="col-3 button text-bg-light border" data-value="0">0</div>
            <div class="col-3 button text-bg-light operator border" data-value=".">.</div>
            <div class="col-3 button equal border" data-value="=">=</div>
        </div>
    </div>
    <script>
        const display = document.getElementById('display');
        const buttons = Array.from(document.getElementsByClassName('button'));
        let calValue = "";

        const brackets = [];
        buttons.forEach(button=>{
            button.addEventListener('click', (e) => {
                let displayValue = e.target.dataset.value;
                try{
                    if(displayValue ==='C'){
                        calValue = ""
                        displayValue = ""
                        brackets.length = 0;
                        display.innerHTML = "";
                    }else if (displayValue ==='bracket'){
                        const lastNumberMatch = calValue.match(/(\d+\.?\d*)$/);
                        const operatorMatch = calValue.match(/[\+\-\*\/]$/);
                        const lastCharIsClosingBracket = calValue.match(/\)$/);
                        const lastCharIsOpeningBracket = calValue.match(/\($/);
                        if (operatorMatch) {
                            displayValue = "(";
                            brackets.push("(");
                        }
                        else if (lastNumberMatch && brackets.length == 0){
                            displayValue = "*("
                            brackets.push("(")
                        }else if (lastNumberMatch && brackets.length != 0){
                            displayValue = ")"
                            brackets.pop()
                        }else if (lastCharIsClosingBracket && brackets.length != 0) {
                            displayValue = ")";
                            brackets.pop();
                        } 
                        else if(displayValue == "") {
                            displayValue = "(";
                            brackets.push("(");
                        }
                        else if (lastCharIsOpeningBracket || calValue == ""){
                            displayValue = "(";
                            brackets.push("(");
                        }
                        else{
                            displayValue = "*(";
                            brackets.push("(");
                        }
                        calValue += displayValue;
                        display.innerHTML += displayValue;
                    }else if(displayValue === 'sqrt') {
                        displayValue = "&radic;("
                        let lastNumberMatch = calValue.match(/(\d+\.?\d*)$/);
                        
                        if (lastNumberMatch) {
                            displayValue = "*" + displayValue;
                            calValue = calValue+'*';
                        }
                        calValue += "Math.sqrt(";
                        brackets.push("(")
                        display.innerHTML += displayValue
                    }else if (displayValue === "square"){
                        displayValue = "<sup>2</sup>"

                        let lastNumberMatch = calValue.match(/(\d+\.?\d*)$/);
                        let lastExpressionMatch = calValue.match(/\(([^()]+)\)$/);

                        if (lastNumberMatch) {
                            let lastNumber = lastNumberMatch[0];
                            let squaredValue = Math.pow(lastNumber, 2);
                            calValue = calValue.replace(/(\d+\.?\d*)$/, squaredValue);
                            display.innerHTML += displayValue;
                        }
                        else if (lastExpressionMatch) {
                            let lastExpression = lastExpressionMatch[1];
                            let squaredValue = Math.pow(eval(lastExpression), 2); 
                            calValue = calValue.replace(/\(([^()]+)\)$/, squaredValue);
                            display.innerHTML += displayValue;
                        } 
                        else {
                            return;
                        }
                    }else if ( displayValue === '='){
                        if(calValue ==""){
                            return;
                        }
                        if (brackets.length != 0) {
                            for (let i = 0; i < brackets.length; i++) {
                                calValue += ")";
                            }
                        }
                        const result = String(eval(calValue))
                        calValue = result 
                        brackets.length = 0;
                        displayValue = result
                        display.innerHTML = displayValue;
                    }
                    else if (['+', '-', '*', '/'].includes(displayValue)) {
                        const lastChar = calValue.slice(-1);

                        if (calValue === "" && displayValue !== '-') {
                            return;
                        }
                        else if (['+', '-', '*', '/'].includes(lastChar)) {
                            calValue = calValue.slice(0, -1) + displayValue;
                            display.innerHTML = display.innerHTML.slice(0, -1) + displayValue;
                        }
                        else if (lastChar === '('){
                            return;
                        }
                        else {
                            calValue += displayValue;
                            display.innerHTML += displayValue;
                        }
                    }
                    else {
                        calValue += displayValue
                        display.innerHTML += displayValue;
                    }
                }catch{
                    display.innerHTML = "Error"
                }

                console.log(calValue)

            })
        })
        
        
    </script>
</body>
</html>